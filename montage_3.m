%**************************************************************************
% Sujet TP électronique analogique
% Date :
% Séance :19/3
%**************************************************************************
clear all;
close all;
clc;
%***************************
% Constantes du circuit
Vcc = 10;
VGSoff = -2.716;
Idss = 7.56e-3;
Id0 = 1e-3;
Vds = Vcc/2 ;
Vss = -10;
Rl = 1000;
%**************************************************************************
% Dimensionnement du circuit
VGs = VGSoff * (1 - sqrt(Id0/Idss));
Vs0  = -(VGs);
Rp  = (Vs0 - Vss)/(2 * Id0) ;
Vrd = Vcc - Vds - Vs0;
Rd = Vrd / Id0;
g_m = (-2)*Idss/VGSoff * (1 - VGs/VGSoff);

%**************************************************************************

V  =   [-3     -1.4  -1.3   -1.2  -1.1  -1    -0.9  -0.8  -0.7  -0.6  -0.5  -0.4  -0.3  -0.2  -0.1  0     0.1    0.2  0.3  0.4   0.5   0.6    0.7   0.8   0.9   1     1.2  1.5   2    2.5   2.7    2.8   2.9   3];Vo =   [10     10    9.99   9.98  9.92  9.81  9.65  9.43  9.17  8.88  8.56  8.23  7.88  7.52  7.15  6.77  6.4    6.03 5.65 5.29  4.93  4.58   4.26  3.97  3.72  3.51  3.25 3.06  2.91 2.83  2.81   2.8   2.79  2.77];
Vs =   [1.31   1.31  1.311  1.314 1.321 1.335 1.356 1.385 1.417 1.451 1.489 1.529 1.57  1.613 1.659 1.704 1.752  1.8  1.85 1.902 1.954 2.007  2.061 2.113 2.162 2.206 2.27 2.327 2.38 2.416 2.428  2.434 2.44  2.446];
figure(1);
plot(V,Vo,'b',V,Vs,'r');
grid on;
xlabel('V');
ylabel('Vo(b) Vs(r)');
hold on ;
Av = 20*log10(Vo./Vs);
plot(V,Av);
hold off;

%**************************************************************************

Ve  = [0.0066 0.00664 0.0076  0.0082  0.0086  0.01   0.0112 0.0192 0.0448 0.088 0.168 0.328 0.432 0.472 0.488 0.488 0.488 0.44  0.316  ];
Vo2 = [0.0082 0.0136  0.026   0.0328  0.0392  0.0512 0.0656 0.126  0.312  0.616 1.2   2.32  2.88  2.88  2.08  1.52  1.24  0.252 0.116 ];
figure(2);
Av2 = 20*log10(Vo2./Ve);
semilogx(fre,Av2);
grid on;
xlabel('fréquence(Hz)');
ylabel('gain(dB)');
%**************************************************************************
%Avec deuxieme transfor , vpp=20 ,ve = Vgate , vo = Vdrain , sans charge

fre = [10     100    200    100e1   100e2  200e2 500e2 600e2 700e2 750e2 800e2 850e2 900e2 100e3 110e3 120e3  140e3 271e3  800e3  100e4];
Ve3 = [0.464  0.576  0.576  0.584   0.592  0.64  1.04  1.2   0.488 0.344 0.264 0.216 0.176 0.124 0.088 0.18   0.124 0.0124 0.0376 0.01];
Vo3 = [2.56   3.92   3.92   4       4.08   4.32  6     6.4   3.24  2.32  1.78  1.44  1.2   0.86  0.6  1.24   0.84   0.0672 0.072  0.02  ];

figure(3);
Av3 = 20*log10(Vo3./Ve3);
semilogx(fre,Av3);
grid on;
hold on; 
%mode commun
fre = [10     100        100e1   100e2   100e3   100e4   500e4];
Ve4 = [2.04   2.04       2.04    2.08    2.08    1.24    2.32];
Vo4 = [0.448  0.552      0.552   0.56    0.56    0.328   0.112];

Av4 = 20*log10(Vo4./Ve4);
semilogx(fre,Av4);
grid on;
hold on;
%**************************************************************************
%mode commun avec partie transistor à vss
fre = [5    10   100   1e3  1e4   1e5     1e6   ];
Ve5 = [6.16 6.08 6.08  6.08 9.4  9.8     9.8  ] ;
Vo5 = [3.44 4.8  5.92  5.92 0.044    0.152   1.14  ];


Av5 = 20*log10(Vo5./Ve5);
semilogx(fre,Av5);
grid on;
